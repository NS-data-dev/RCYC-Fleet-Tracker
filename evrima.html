<script>
  var mst_width = "100%";
  var mst_height = "520px";
  var mst_border = "0";

  var mst_map_style = "simple";
  var mst_mmsi = "215001000"; // change per page
  var mst_show_track = "true";
  var mst_show_info = "true";

  var mst_fleet = "";
  var mst_lat = "";
  var mst_lng = "";
  var mst_zoom = "6";
  var mst_show_names = "1";
  var mst_scroll_wheel = "false";
  var mst_show_menu = "0";

  function loadMST(tryNo) {
    // remove old script if present
    const old = document.getElementById("myshiptrackingscript");
    if (old) old.remove();

    const s = document.createElement("script");
    s.id = "myshiptrackingscript";
    s.src = "https://www.myshiptracking.com/js/widgetApi.js?cb=" + Date.now();
    s.onload = () => {
      // If MST returns an internal error page, retry once after a short delay
      setTimeout(() => {
        const txt = (document.body.innerText || "").toLowerCase();
        if (txt.includes("internal server error") && tryNo < 2) {
          location.reload();
        }
      }, 1500);
    };
    s.onerror = () => {
      if (tryNo < 2) setTimeout(() => loadMST(tryNo + 1), 1500);
    };
    document.body.appendChild(s);
  }

  window.addEventListener("load", () => loadMST(1));
</script>
